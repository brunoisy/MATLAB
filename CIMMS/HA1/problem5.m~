load('RSSI-measurements-unknown-sigma')
load('stations')
%rng(3)

N = 1000; % #particles
m = length(Y(1,:));

X = drawInitPart(N);

k = 20;
sigmas = linspace(0.5,3,k);
like = ones(1,length(sigmas));

for i = 1:k;
    w = p(X, Y(:,1),sigmas(i));
    like(i) = mean(w)
    for n=1:m-1
        %updating
        X = updatePart(X);
        w = p(X, Y(:,n+1), sigmas(i));
        
        %resampling
        inds = randsample(N,N,true,w);
        X = X(:,inds);
        
        %estimation of cn
        like(i) = mean(w)*like(i);
    end
end
[~, indmax] = max(like);
sigmamax = sigmas(indmax)




