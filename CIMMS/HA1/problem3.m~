load('RSSI-measurements')
load('stations')
rng(3)

N = 200; % #particles
m = 100;

delta = 0.5;
alpha = 0.6;
phi_tild = [1,delta,delta^2/2; 0,1,delta; 0,0,alpha];
psi_z_tild = [delta^2/2; delta; 0];
psi_w_tild = [delta^2/2; delta; 1];
phi = [phi_tild,zeros(3,3); zeros(3,3),phi_tild];
psi_z = [psi_z_tild,zeros(3,1); zeros(3,1),psi_z_tild];
psi_w = [psi_w_tild,zeros(3,1); zeros(3,1),psi_w_tild];

X = drawInitPart(N);
w = zeros(1,N);
for i=1:N %vectorise
    w(i) = p(Y(:,1), X(:,i));
end


tau1 = zeros(1,m)
for n=1:m
    X = updatePart(X);
    
    % update weights
    for i=1:N %vectorise
        w(i) = p(Y(:,n), X(:,i))*w(i);
    end
    
    tau(1) = sum(X(1,:).*w)/sum(w);
    tau(2) = sum(X(4,:).*w)/sum(w);
end

